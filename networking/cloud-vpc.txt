-------------------------------
-- Cloud VPC - Intro
-------------------------------

- What is a VPC (Virtual Private Cloud)?

Physical Network
    - uses hardware components to facilitate communication and data transfer
    - routers, switches, servers, cables

Virtual Network
    - abstracts the hardware components into software components
    - virtual firewalls, network policies, and segmentation

Cloud VPC = Logically-isolated virtual network
            Essentially a physical network, but virtualized within VPC.


-------------------------------
-- IP Addresses
-------------------------------

    unique numerical identifiers assigned to each device connected to a network,
        allowing them to communicate with one another

    two main versions:
        IPv4 (e.g. 192.168.1.1) (32-bit, most commonly used format)
        IPv6 (e.g. 2001:0db8:85a3:0000:0000:8a2e:0370:7334) (32-bit)
    
    Private IP addresses are specific IP addresses used within private network such as in homes, offices,
        or cloud environments
        - *** the establishment of these private IP addresses, through VPC and subnets, is what allows
            seamless internal communication***
    
        typical private IP ranges
            10.0.0.0/8 - often used in large private networks, corporate envs. 16.8 million total IPs
                       - "10." is fixed, and everything to the right can be up to 255.255.255
            172.16.0.0/12 - medium-sized private networks, small to medium enterprises
                          - 1 million total IPs
            192.168.0.0/16 - common in home networks and small office routers
                           - total IPs: 66, 536

CIDR notation (IPv4)

X.X.X.X/Y

- numbers before the ^slash (Xs) determines the starting IP address of the network range
- number after the slash (Y) determines the number of possible IP addresses
    it tells us how many bits are used for the network part of the address

to figure out the number of possible IP address in a subnet:

    1. identify the number after the slash
    2. subtract it from 32
    3. calculate 2 to the power of that number

e.g.
    192.168.0.0/12 --> 32 - 12 = 20.
                   --> 2^20 = 1,048,576 possible IP addresses


-------------------------------
-- Subnets
-------------------------------

Subnets function as logical subdivisions within a VPC that enables more granular traffic control

subnet creation
    subnets are defined at the region level.
    user specifies the IP range, using CIDR notations

two tules on subnet creation:
    1. Subnet IP range must be within the overall range of the VPC
        e.g., if your VPC has CIDR block of 10.0.0.0/16, the subnets you create 
        must have IP ranges that fall within this overall range,
        such as 10.0.1.0/24 or 10.0.2.0/24
    2. Subnet IP range cannot overlap with other subnets in the same VPC to prevent IP address conflicts

if you run out of IP addresses in your subnet, you can expand the subnet's IP range
without needing to delete and recreate a subnet

0.0.0.0/0 is not valid for a private subnet as it represents the default route for all IP addresses


-------------------------------
-- Private Google Access
-------------------------------

enabling "Private Google Access" allows VM instances with only internal IP addresses to connect to Google
APIs and services without having external IP addresses


if you have a VM inside your VPC, and if you dont have Private Google Access enabled, you will have to
have that VM have an external IP so that it can communicate with GCP's APIs/services


-------------------------------
-- Private Service Connect
-------------------------------

PSC creates a private, internal connection between services within your VPC
can also connect outside of the VPC


Private Google Access vs Private Service Connect
    Private Google Access is useful for outbound access from a private subnet to Google APIs,
        butit doesnt provide inbound connectivity between services
        (only one-directional. doesnt provide inbound access)

    Private Service Connect ensures private internal communication


-------------------------------
-- Connecting to other networks
-------------------------------

- Shared VPC
    allows you to extend the network from one project (host project) to other projects (service projects)
        within the same organization

    *note* host project should be dedicated to network resource control only. 
        pipelines, ETLs, etc. that need to use the Shared VPC should be in the service projects
    
    - Granting Service Accounts access in Shared VPC    
        svc accts in the service projects must be granted the compute.networkUser role on the 
            shared VPC subnets in the host project to access network resources

        e.g. give your Dataflow pipeline svc acct compute.networkUser role on your subnet to deploy on the Shared VPC


- VPC Peering
    allows connection of two VPC networks so they can communicate using internal, private IP addresses

    connected VPCs can be either in the same org OR different orgs


- Cloud VPN
    connects an on-prem network, another cloud provider network, or a remote office network to a Cloud VPC
        in GCP. Encrypted, but uses the public internet


- Cloud Interconnect
    a Separate GCP service that offers a secure, private, high-bandwidth connection from on-prem to GCP
    consistent low-latency performance for tasks like large-scale data replication, disaster recovery, real-time processing

    Types of Cloud Interconnect
        Dedicated Interconnect - direct physical connection between on-prem and GCP
                               - best for high-bandwidth, low latency, and direct private connectivity needs
        Partner Interconnect   - goes through a supported service provider
                               - suitable when lower bandwidth is okay or geographic flexibility is needed 
                                    (if your data center is not near a Google Cloud edge location)
        Cross-Cloud Interconnect - direct connection between your network in another cloud and Google's network


-------------------------------
-- Project Isolation Techniques
-------------------------------

Separate VPCs (Network Layer Isolation)
    creating separate VPCs in each project and ensuring there is no peering or routing between them
    this works at the network layer

VPC Service Controls (Service Layer Isolation)
    create a security perimeter around each project, preventing data exfiltration and 
    ensuring resources in one project cannot access resources in another project
    This works at the service layer

    *Gemini*
        Create a service perimeter: You configure a service perimeter at the organization level, which acts as the security boundary.
        Add projects and services: You add GCP projects and services (like Cloud Storage, BigQuery, etc.) to the perimeter.
        Define access policies: You set ingress and egress rules to control traffic to and from the perimeter. For example, you can create an ingress rule that only allows access to a Cloud Storage bucket from specific VPC networks within the perimeter.
        Enforce the perimeter: Once the perimeter and its rules are set up, access to the protected services from outside the perimeter is denied by default. 



